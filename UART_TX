Main.c (HAL coding)

#include "stm32f4xx.h"
#include "stdint.h"

#define GPIOAEN     (1<<0)
#define UART2EN     (1<<17)

#define CR1_TE       (1<<3)
#define CR1_UE       (1<<13)
#define SR_TXE       (1<<7)

#define SYS_FREQ     16000000
#define APB1_CLK   SYS_FREQ
#define UART_BAUDRATE   9600


/* CONFIGURE UART GPIO PIN
 * FROM ALTERNATE FN. TABLE 9 USART2_TX ->PA2 -> AF07
	 */
static void uart_set_baudrate(USART_TypeDef *USARRTx,uint32_t PeriphClk, uint32_t BaudRate );
static uint16_t compute_uart_bd(uint32_t PeriphClk, uint32_t BaudRate);
void UART2_TX_Init(void);
void UART2_write(int ch);

int main()
{
	UART2_TX_Init();
  while(1)
  {
	  UART2_write('y');
  }
	return 0;
}

void UART2_TX_Init(void)
{
	 /******CONFIGURE UART GPIO PIN***********/

	 //ENABLE DATA BUS WITH REFERNCE MANUAL 6.3.11
	  RCC ->AHB1ENR |= GPIOAEN;
	//SET PA2 MODE TO ALTERNATE FUNCTION MODE WITH REFERNCE MANUAL 8.4.1
	 GPIOA ->MODER &=~(1<<4);
	 GPIOA ->MODER |=(1<<5);
	/*SET PA2 ALTERNATE FUNCTION TYPE TO UART_TX(AF07)
	 * WITH REFERNCE MANUAL 8.4.9
	 * HERE PA2 -> AFRL2 (BIT 8,9,10,11)
	 * AF7 -> 0111    AFRL ->AFR[0]   AFRH ->AFR[1]
	 */
     GPIOA ->AFR[0]|=(1<<8);
     GPIOA ->AFR[0]|=(1<<9);
     GPIOA ->AFR[0]|=(1<<10);
     GPIOA ->AFR[0]&=~(1<<11);
	 /******CONFIGURE UART MODULE***********/

	//ENBALE CLOCK ACCESS TO UART2
	RCC ->APB1ENR |= UART2EN;
	//CONFIGURE BAUDRATE
	uart_set_baudrate(USART2,APB1_CLK, UART_BAUDRATE );
	//CONFIGURE TRANSFER DIRECTION WITH REFERNCE MANUAL 19.6.4 USART_CR1
	USART2 ->CR1 = CR1_TE;
	// ENABLE UART MODULE WITH CONTROL REGISTER 1
	USART2 ->CR1 |= CR1_UE;


}

void UART2_write(int ch){

   //MAKE SURE THE TRANSMIT DATA TRANSFER IS EMPTY
	while(!(USART2 ->SR & SR_TXE))
	{

	}
	//WRITE TO TRANSMIT DATA REGISTER WITH REFERENCE MANUAL 19.6.1
	USART2 ->DR =(ch &0xFF);

}



static void uart_set_baudrate(USART_TypeDef *USARTx,uint32_t PeriphClk, uint32_t BaudRate )
{
	USARTx ->BRR =compute_uart_bd(PeriphClk,BaudRate);
}

static uint16_t compute_uart_bd(uint32_t PeriphClk, uint32_t BaudRate)
{
	return (PeriphClk + (BaudRate/2U)) /BaudRate;
}
